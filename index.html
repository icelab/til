<!DOCTYPE html><html lang="en-au"><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="Today Icelab Learned" property="og:site_name" /><meta content="http://til.icelab.com.au/" property="og:url" /><meta content="article" property="og:type" /><meta content="A knowledgebase of little learnings from the team at Icelab." property="og:description" /><script>!function(o){function t(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return o[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var e={};return t.m=o,t.c=e,t.p="",t(0)}({0:function(o,t,e){o.exports=e(12)},11:function(o,t){window.localStorage.getItem("fontsLoaded")&&(window.document.documentElement.className+=" fonts-loaded")},12:function(o,t,e){e.p="/assets/",e(11)}});</script><link href="http://til.icelab.com.au/assets/public/favicon-fe80d575.png" rel="shortcut icon" /><link href="http://til.icelab.com.au/assets/public-8b27d484.css" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700:latin" rel="stylesheet" type="text/css" /><script async="" src="http://til.icelab.com.au/assets/public-49d86d77.js"></script><title>Today Icelab Learned</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', "UA-2193586-3", 'auto');
ga('send', 'pageview');</script><link href="/feed.xml" rel="alternate" title="Today Icelab Learned" type="application/atom+xml" /></head><body><aside class="sidebar" id="sidebar"><button class="close-sidebar" data-view-toggle-sidebar="">Hide topics &rsaquo; </button><div class="sidebar-topic"><a href="/topics/accessibility">accessibility</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/aws">aws</a><span class="topic-count"> (<i>3</i>)</span></div><div class="sidebar-topic"><a href="/topics/css">css</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/debugging">debugging</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/git">git</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/html">html</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/javascript">javascript</a><span class="topic-count"> (<i>3</i>)</span></div><div class="sidebar-topic"><a href="/topics/ops">ops</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/performance">performance</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/postgres">postgres</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/processing">processing</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/rails">rails</a><span class="topic-count"> (<i>4</i>)</span></div><div class="sidebar-topic"><a href="/topics/react">react</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/regex">regex</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/ruby">ruby</a><span class="topic-count"> (<i>10</i>)</span></div><div class="sidebar-topic"><a href="/topics/seo">seo</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/slim">slim</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/social">social</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/testing">testing</a><span class="topic-count"> (<i>1</i>)</span></div></aside><div class="header"><a class="header__logo" href="http://www.icelab.com.au"></a><a href="/" class="header__til-text">Today Icelab Learned</a><button class="header__view-topics open-sidebar" data-view-toggle-sidebar="">&lsaquo; <span>View</span> topics </button></div><div class="container"><div class="article"><h2 class="article__title"><a href="/improving-accessibility-with-visually-hidden-labels/">Improving accessibility with visually hidden&nbsp;labels</a></h2><div class="article__meta">Andy McCray, 07 June 2016</div><div class="article__content" data-view-highlight=""><p>Accessibility is something that&rsquo;s always in the front of our minds when building websites at Icelab. It&rsquo;s particularly important for Government work which requires specific <a href="https://www.w3.org/WAI/intro/wcag">WCAG</a> adherence.</p>

<p>A pattern we use often is to <em>visually hide</em> additional descriptive labels. These labels will be announced by screen readers but not rendered on the screen. Take this common snippet:</p>
<pre class="highlight slim"><code><span class="nt">ul</span><span class="nc">.social-icons__list</span>
  <span class="nt">li</span><span class="nc">.social-icons__list-item</span>
    <span class="nt">a</span><span class="nc">.social-icons__anchor</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"http://twitter.com/andymccray"</span>
      <span class="nt">i</span><span class="nc">.fa.fa-twitter</span>
  <span class="nt">li</span><span class="nc">.social-icons__list-item</span>
    <span class="nt">a</span><span class="nc">.social-icons__anchor</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"mailto:andy@icelab.com.au"</span>
      <span class="nt">i</span><span class="nc">.fa.fa-envelope</span>
</code></pre>

<p>With that we have a nice Twitter bird and envelope icon (courtesy of <a href="http://fontawesome.io/">Font Awesome</a>). Perfect!</p>

<p>…well, not so perfect really. We can make the experience much nicer for visually impaired users with a little extra effort:</p>
<pre class="highlight slim"><code><span class="nt">ul</span><span class="nc">.social-icons__list</span>
  <span class="nt">li</span><span class="nc">.social-icons__list-item</span>
    <span class="nt">a</span><span class="nc">.social-icons__anchor</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"http://twitter.com/andymccray"</span>
      <span class="nt">span</span><span class="nf">#twitter-label</span><span class="nc">.hide-visually</span><span class="w"> </span>Follow<span class="w"> </span>Andy<span class="w"> </span>McCray<span class="w"> </span>on<span class="w"> </span>Twitter
      <span class="nt">i</span><span class="nc">.fa.fa-twitter</span><span class="w"> </span><span class="na">aria-labelledby</span><span class="p">=</span><span class="s">"twitter-label"</span>
  <span class="nt">li</span><span class="nc">.social-icons__list-item</span>
    <span class="nt">a</span><span class="nc">.social-icons__anchor</span><span class="w"> </span><span class="na">href</span><span class="p">=</span><span class="s">"mailto:andy@icelab.com.au"</span>
      <span class="nt">span</span><span class="nf">#email-label</span><span class="nc">.hide-visually</span><span class="w"> </span>Email<span class="w"> </span>Andy<span class="w"> </span>McCray
      <span class="nt">i</span><span class="nc">.fa.fa-envelope</span><span class="w"> </span><span class="na">aria-labelledby</span><span class="p">=</span><span class="s">"email-label"</span>
</code></pre>

<p>We&rsquo;re also using the <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques/Using_the_aria-labelledby_attribute">aria-labelledby</a> attribute to provide further clarification to screen readers.</p>

<p>And the CSS:</p>
<pre class="highlight css"><code><span class="c">/*
 * Hide only visually, but have it available for screen readers:
 * http://snook.ca/archives/html_and_css/hiding-content-for-accessibility
 */</span>

<span class="nc">.hide-visually</span> <span class="p">{</span>
  <span class="nl">border</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">clip</span><span class="p">:</span> <span class="n">rect</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="p">);</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">1px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">-1px</span><span class="p">;</span>
  <span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">1px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>

<p>And with that our screen reader users will have a much friendlier experience getting in touch.</p>
</div><div class="article__tags"><a href="/topics/accessibility" class="article__tag">accessibility</a></div></div><div class="article"><h2 class="article__title"><a href="/uri-regex-ruby/">URI regular&nbsp;expressions</a></h2><div class="article__meta">Daniel Nitsikopoulos, 01 June 2016</div><div class="article__content" data-view-highlight=""><p>Let&rsquo;s go ahead and write some regex to validate a URI in Ruby:</p>

<p><img src="http://vignette3.wikia.nocookie.net/arresteddevelopment/images/e/ef/2x04_Good_Grief_%2832%29.png/revision/latest/scale-to-width-down/640?cb=20121126044547" alt="Good Grief" /></p>
<pre class="highlight ruby"><code><span class="no">URI</span><span class="p">.</span><span class="nf">regexp</span>
</code></pre>

<p>That&rsquo;s it!</p>

<p>We can use it like so</p>
<pre class="highlight ruby"><code><span class="no">URI</span><span class="p">.</span><span class="nf">regexp</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">my_uri</span><span class="p">)</span>
</code></pre>

<p>If you have a look at the output of <code>URI.regexp</code> in <code>irb</code>, you&rsquo;ll see the pattern that&rsquo;s used to match against. It&rsquo;s relatively complex, but each capture group is documented.</p>

<ol>
<li>Scheme</li>
<li>Opaque (e.g. scheme:foo/bar)</li>
<li>User Info</li>
<li>Host</li>
<li>Port</li>
<li>Registry</li>
<li>Path</li>
<li>Query</li>
<li>Fragment</li>
</ol>
<pre class="highlight ruby"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">URI</span><span class="p">.</span><span class="nf">regexp</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="s2">"http://username:password@foo.bar:80/baz.html?query=string#fragment"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;MatchData "http://username:password@foo.bar:80/baz.html?query=string#frag" 1:"http" 2:nil 3:"username:password" 4:"foo.bar" 5:"80" 6:nil 7:"/baz.html" 8:"query=string" 9:"frag"&gt;</span>
</code></pre>
</div><div class="article__tags"><a href="/topics/regex" class="article__tag">regex</a><a href="/topics/ruby" class="article__tag">ruby</a></div></div><div class="article"><h2 class="article__title"><a href="/creating-and-storing-ssl-certificates/">Creating and storing SSL&nbsp;certificates</a></h2><div class="article__meta">Jojo Hall, 24 May 2016</div><div class="article__content" data-view-highlight=""><p>As part of the SSL Certificate generation process you&rsquo;ll need to create a Certificate Signing Request. You can do this with the command:</p>
<pre class="highlight plaintext"><code>openssl req -nodes -newkey rsa:2048 -sha256 -keyout server.key -out server.csr
</code></pre>

<p>This will generate two files: a public .csr file, and a private .key file</p>

<p>You can view the files with the commands <code>cat server.csr</code> and <code>cat server.key</code></p>

<p>Here at Icelab we recommend saving this information in a new 1Password secure note named with the following format:</p>
<pre class="highlight plaintext"><code>[domain-name.com] SSL CSR
</code></pre>

<p>Save the data from both files into the secure note and continue to be happy and confident in the face of adversity :)</p>
</div><div class="article__tags"><a href="/topics/ops" class="article__tag">ops</a></div></div><div class="article"><h2 class="article__title"><a href="/hash-new-with-a-block-works-well-as-a-keyed-cache/">Hash.new with a block works well as a keyed&nbsp;cache</a></h2><div class="article__meta">Tim Riley, 23 May 2016</div><div class="article__content" data-view-highlight=""><p>We&rsquo;re all familiar with the <code>@foo ||= expensive_computation</code> technique to memoize (i.e. cache) the output of slow computations or to avoid unnecessary object creation.</p>

<p>If you want to do the same but with results that will vary by a single parameter, you can use Ruby&rsquo;s hash with its <a href="http://ruby-doc.org/core-2.3.1/Hash.html#method-c-new">block-based initializer</a> to handle the caching for you:</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">my_cache</span>
  <span class="vi">@my_cache</span> <span class="o">||=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="nb">hash</span><span class="p">,</span> <span class="n">key</span><span class="o">|</span>
    <span class="nb">hash</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">some_slow_computation</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Computed once</span>
<span class="n">my_cache</span><span class="p">[</span><span class="ss">:foo</span><span class="p">]</span>

<span class="c1"># Then cached</span>
<span class="n">my_cache</span><span class="p">[</span><span class="ss">:foo</span><span class="p">]</span>
</code></pre>

<p>You can see this work in practice <a href="https://github.com/dry-rb/dry-component/blob/0bebc656b625a18c25e3c8d9c4b71946fecac5e1/lib/dry/component/injector.rb#L56-L60">inside dry-component&rsquo;s Injector</a>, where it caches objects to allow arbitrarily long chaining of injector strategies without creating duplicate injector objects.</p>
</div><div class="article__tags"><a href="/topics/ruby" class="article__tag">ruby</a></div></div><div class="article"><h2 class="article__title"><a href="/selecting-colours-in-html/">Selecting colours in&nbsp;HTML</a></h2><div class="article__meta">Max Wheeler, 22 May 2016</div><div class="article__content" data-view-highlight=""><p>Somehow in the excitement around HTML5’s new input types I missed the addition of an input type specifically for selecting colours:</p>
<pre class="highlight html"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"color"</span><span class="nt">&gt;</span>
</code></pre>

<p>Include this and you’ll get a platform-native colour selector that takes and returns hex colour values, like my debugging colour of choice <code>#ff0099</code>:</p>

<p data-height="200" data-theme-id="0" data-slug-hash="vGogBW" data-default-tab="result" data-user="makenosound" data-embed-version="2" class="codepen">Selecting colours in HTML <a href="http://codepen.io/makenosound/pen/vGogBW/">vGogBW</a></p>

<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>Note that the value needs to a fully hex string, not a shortcut like <code>#f09</code>. And, alas, if you’re viewing this in Safari you’ll notice that it isn’t supported at all.</p>
</div><div class="article__tags"><a href="/topics/html" class="article__tag">html</a></div></div><div class="article"><h2 class="article__title"><a href="/creating-an-iam-user-for-s3-bucket/">Creating an IAM user for access to an S3&nbsp;bucket</a></h2><div class="article__meta">Tim Riley, 04 April 2016</div><div class="article__content" data-view-highlight=""><p>When you create an S3 bucket for a web app to use, you should create a specific IAM user to grant access to that bucket.</p>

<p>To do this, first create a user:</p>

<ol>
<li>Visit the <a href="https://console.aws.amazon.com/iam">IAM section of the AWS console</a></li>
<li>Go to the &ldquo;Users&rdquo; section and click the &ldquo;Create New Users&rdquo; button</li>
<li>Enter the user name(s) you want to create (e.g. <code>my-bucket-s3</code> for a bucket named <code>my-bucket</code>)</li>
<li>When you&rsquo;re shown the user credentials, save them somewhere safe, like our team 1Password vault</li>
<li>When you return to the IAM users list, go to the newly created user and click on their &ldquo;Permissions&rdquo; tab. Click on the &ldquo;Inline Policies&rdquo; section and create a new policy</li>
<li>Choose to create a &ldquo;Custom Policy&rdquo;</li>
<li><p>Name the policy &ldquo;my-bucket-s3-access&rdquo; (or something similarly descriptive) and paste the following into the &ldquo;Policy Document&rdquo; area (replacing <code>my-bucket</code> with your bucket&rsquo;s name):</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:ListAllMyBuckets"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::*"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:*"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::my-bucket"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::my-bucket/*"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></li>
<li><p>Click &ldquo;Apply Policy&rdquo;</p></li>
</ol>

<p>The access policy should now be active and your app should be able to access the bucket with the new IAM user&rsquo;s credentials.</p>
</div><div class="article__tags"><a href="/topics/aws" class="article__tag">aws</a></div></div><div class="article"><h2 class="article__title"><a href="/chrome-vox/">ChromeVox</a></h2><div class="article__meta">Andy McCray, 08 March 2016</div><div class="article__content" data-view-highlight=""><p><a href="http://www.chromevox.com/">ChromeVox</a> is a screen reader extension for Chrome.</p>

<p>I found it a helpful extension when addressing accessibility issues on a recent project. I was able to replicate the voice prompts noted in the accessibility audit. Thus, fixing them was much easier!</p>

<p>One thing to note is that you&rsquo;ll want to change the default voice. The default just seems to cackle at you. You can do this via <code>Settings &gt; Extensions &gt; ChromeVox &gt; Options</code>.</p>
</div><div class="article__tags"><a href="/topics/accessibility" class="article__tag">accessibility</a></div></div><div class="article"><h2 class="article__title"><a href="/cloudfront-origin-pull-with-gzip/">Using CloudFront as ‘origin pull’ (with bonus&nbsp;gzip)</a></h2><div class="article__meta">Max Wheeler, 16 February 2016</div><div class="article__content" data-view-highlight=""><p>CloudFront can act as a CDN that ‘pulls’ content from an origin server. It’s really easy to set up, you simply set the ‘Origin Domain Name’ to wherever you’re hosting your app: <code>foobar.herokuapp.com</code> for example and then &hellip; nothing. That’s all you need to do. Requests that come through CloudFront will pass through to your origin server and then be cached thereafter.</p>

<p>For bonus points it’ll also gzip your content for you without you having to do much work at all. Set ‘Compress Objects Automatically’ to ‘Yes’ and you’re done. If CloudFront can serve a gzipped version (and the client can receive one) it’ll serve up a compressed version of your file instead.</p>
</div><div class="article__tags"><a href="/topics/performance" class="article__tag">performance</a><a href="/topics/aws" class="article__tag">aws</a></div></div><div class="article"><h2 class="article__title"><a href="/symbolize-keys/">Symbolize&nbsp;keys</a></h2><div class="article__meta">Jojo Hall, 19 November 2015</div><div class="article__content" data-view-highlight=""><p>If you&rsquo;re writing plain old Ruby you can symbolize the keys of a hash with the following:</p>
<pre class="highlight ruby"><code><span class="nb">hash</span><span class="p">.</span><span class="nf">inject</span><span class="p">({}){</span><span class="o">|</span><span class="n">memo</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">|</span> <span class="n">memo</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="nf">to_sym</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span> <span class="n">memo</span><span class="p">}</span>
</code></pre>

<p>This does the following:</p>
<pre class="highlight ruby"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"jojo"</span><span class="p">}</span>
<span class="nb">hash</span><span class="p">.</span><span class="nf">inject</span><span class="p">({}){</span><span class="o">|</span><span class="n">memo</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">|</span> <span class="n">memo</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="nf">to_sym</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span> <span class="n">memo</span><span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:hello</span><span class="o">=&gt;</span><span class="s2">"jojo"</span><span class="p">}</span>
</code></pre>

<p>However if you&rsquo;re doing this in a web application you may want to make a module to make hash and array data transformations easily available to you. In most of our apps we would use <a href="https://github.com/solnic/transproc">transproc</a> to help us with this — if you&rsquo;re working in one of Icelab&rsquo;s Rodakase apps this will be available to you.</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s2">"transproc/all"</span>

<span class="k">module</span> <span class="nn">Functions</span>
  <span class="kp">extend</span> <span class="no">Transproc</span><span class="o">::</span><span class="no">Registry</span>

  <span class="n">import</span> <span class="no">Transproc</span><span class="o">::</span><span class="no">HashTransformations</span>
  <span class="n">import</span> <span class="no">Transproc</span><span class="o">::</span><span class="no">ArrayTransformations</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">t</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">[</span><span class="o">*</span><span class="n">args</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Functions</span><span class="p">.</span><span class="nf">t</span><span class="p">(</span><span class="ss">:symbolize_keys</span><span class="p">)[{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="s2">"bar"</span><span class="p">}]</span>
<span class="c1"># =&gt; {foo: "bar"}</span>
</code></pre>

<p>If you are using Rails then you can use the method <code>hash.symbolize_keys</code> or the destructive version <code>hash.symbolize_keys!</code><br>
(both made available via ActiveSupport).</p>
</div><div class="article__tags"><a href="/topics/ruby" class="article__tag">ruby</a></div></div><div class="article"><h2 class="article__title"><a href="/async-set-state/">In React setState is not &quot;guaranteed&quot; to be&nbsp;synchronous.</a></h2><div class="article__meta">Narinda Reeders, 19 November 2015</div><div class="article__content" data-view-highlight=""><p>I discovered recently that if you do something link this in react:</p>
<pre class="highlight javascript"><code><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">reallyUseful</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>

<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">reallyUseful</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">doSomethingAmazing</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>&hellip; it&rsquo;s not very useful and more often than not nothing amazing happens, just confusion and sadness.</p>

<p>This is because <code>setState</code> it turns out, is asynchronous. Of course most of the time you are doing your amazing things in your render function so everything is sweet but on the odd occasion that you need to pass that value elsewhere, eg: publishing an event, beware!</p>

<p>From the docs:</p>

<blockquote>
<p>setState() does not immediately mutate this.state but creates a pending state transition. Accessing this.state after calling this method can potentially return the existing value.</p>

<p>There is no guarantee of synchronous operation of calls to setState and calls may be batched for performance gains.</p>
</blockquote>

<p>Read about <code>setState</code> <a href="https://facebook.github.io/react/docs/component-api.html">here</a>.</p>

<p><em>Editor’s note — <code>setState</code> will also take a callback as its second argument that’ll be executed after <code>this.state</code> has been updated:</em></p>
<pre class="highlight javascript"><code><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span>
  <span class="p">{</span> <span class="na">reallyUseful</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">reallyUseful</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">doSomethingAmazing</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>
</div><div class="article__tags"><a href="/topics/react" class="article__tag">react</a><a href="/topics/javascript" class="article__tag">javascript</a></div></div><div class="pagination"><a href="/page/2/" class="pagination__older">Older &rsaquo;</a></div></div><div class="footer">A knowledgebase of little learnings from the team at Icelab. <a href="https://github.com/icelab/til/">Source on GitHub</a>.</div><script>!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(10)},,,,,,,function(t,e){!function(){function e(t,e){r?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function n(t){document.body?t():r?document.addEventListener("DOMContentLoaded",t):document.attachEvent("onreadystatechange",function(){"interactive"!=document.readyState&&"complete"!=document.readyState||t()})}function i(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function o(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+e+";"}function a(t){var e=t.a.offsetWidth,n=e+100;return t.f.style.width=n+"px",t.c.scrollLeft=n,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e?(t.g=e,!0):!1}function l(t,n){function i(){var t=o;a(t)&&null!==t.a.parentNode&&n(t.g)}var o=t;e(t.b,i),e(t.c,i),a(t)}function s(t,e){var n=e||{};this.family=t,this.style=n.style||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"normal"}function c(){if(null===f){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(e){}f=""!==t.style.font}return f}function d(t,e){return[t.style,t.weight,c()?t.stretch:"","100px",e].join(" ")}var r=!!document.addEventListener,h=null,f=null,m=!!window.FontFace;s.prototype.load=function(t,e){var a=this,s=t||"BESbswy",c=e||3e3,r=(new Date).getTime();return new Promise(function(t,e){if(m){var f=new Promise(function(t,e){function n(){(new Date).getTime()-r>=c?e():document.fonts.load(d(a,a.family),s).then(function(e){1<=e.length?t():setTimeout(n,25)},function(){e()})}n()}),u=new Promise(function(t,e){setTimeout(e,c)});Promise.race([u,f]).then(function(){t(a)},function(){e(a)})}else n(function(){function n(){var e;(e=-1!=w&&-1!=y||-1!=w&&-1!=v||-1!=y&&-1!=v)&&((e=w!=y&&w!=v&&y!=v)||(null===h&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),h=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=h&&(w==g&&y==g&&v==g||w==x&&y==x&&v==x||w==b&&y==b&&v==b)),e=!e),e&&(null!==T.parentNode&&T.parentNode.removeChild(T),clearTimeout(E),t(a))}function f(){if((new Date).getTime()-r>=c)null!==T.parentNode&&T.parentNode.removeChild(T),e(a);else{var t=document.hidden;!0!==t&&void 0!==t||(w=m.a.offsetWidth,y=u.a.offsetWidth,v=p.a.offsetWidth,n()),E=setTimeout(f,50)}}var m=new i(s),u=new i(s),p=new i(s),w=-1,y=-1,v=-1,g=-1,x=-1,b=-1,T=document.createElement("div"),E=0;T.dir="ltr",o(m,d(a,"sans-serif")),o(u,d(a,"serif")),o(p,d(a,"monospace")),T.appendChild(m.a),T.appendChild(u.a),T.appendChild(p.a),document.body.appendChild(T),g=m.a.offsetWidth,x=u.a.offsetWidth,b=p.a.offsetWidth,f(),l(m,function(t){w=t,n()}),o(m,d(a,'"'+a.family+'",sans-serif')),l(u,function(t){y=t,n()}),o(u,d(a,'"'+a.family+'",serif')),l(p,function(t){v=t,n()}),o(p,d(a,'"'+a.family+'",monospace'))})})},window.FontFaceObserver=s,window.FontFaceObserver.prototype.check=window.FontFaceObserver.prototype.load=s.prototype.load,"undefined"!=typeof t&&(t.exports=window.FontFaceObserver)}()},,function(t,e,n){function i(t){var e=window.localStorage.getItem("fontsLoaded");if(!e){var n=[];t.forEach(function(t){var e=new window.FontFaceObserver(t.family,{weight:t.weight,style:t.style});n.push(e.check())}),Promise.all(n).then(function(){window.document.documentElement.className+=" fonts-loaded",window.localStorage.setItem("fontsLoaded",!0)})}}n(7);var o=[{family:"National",style:"normal",weight:"normal"},{family:"National",style:"italic",weight:"normal"},{family:"National",style:"italic",weight:"bold"},{family:"National",style:"italic",weight:"bold"},{family:"TiemposText",style:"normal",weight:"normal"},{family:"TiemposText",style:"italic",weight:"normal"},{family:"TiemposText",style:"italic",weight:"bold"},{family:"TiemposText",style:"italic",weight:"bold"},{family:"Inconsolata",style:"normal",weight:"400"},{family:"Inconsolata",style:"italic",weight:"400"}];i(o)},function(t,e,n){n.p="/assets/",n(9)}]);</script></body></html>