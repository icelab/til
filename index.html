<!DOCTYPE html><html lang="en-au"><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="Today Icelab Learnt" property="og:site_name" /><meta content="http://til.icelab.com.au/" property="og:url" /><meta content="article" property="og:type" /><script>!function(o){function t(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return o[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var e={};return t.m=o,t.c=e,t.p="",t(0)}({0:function(o,t,e){o.exports=e(11)},10:function(o,t){window.localStorage.getItem("fontsLoaded")&&(window.document.documentElement.className+=" fonts-loaded")},11:function(o,t,e){e.p="/assets/",e(10)}});</script><link href="http://til.icelab.com.au/assets/public/favicon-fe80d575.png" rel="shortcut icon" /><link href="http://til.icelab.com.au/assets/public-8b27d484.css" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700:latin" rel="stylesheet" type="text/css" /><script async="" src="http://til.icelab.com.au/assets/public-71f063b5.js"></script><title>Today Icelab Learnt</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', "UA-2193586-3", 'auto');
ga('send', 'pageview');</script><link href="/feed.xml" rel="alternate" title="Today Icelab Learnt" type="application/atom+xml" /></head><body><aside class="sidebar" id="sidebar"><button class="close-sidebar" data-view-toggle-sidebar="">Hide topics &rsaquo; </button><div class="sidebar-topic"><a href="/topics/accessibility">accessibility</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/aws">aws</a><span class="topic-count"> (<i>3</i>)</span></div><div class="sidebar-topic"><a href="/topics/css">css</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/debugging">debugging</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/git">git</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/html">html</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/javascript">javascript</a><span class="topic-count"> (<i>3</i>)</span></div><div class="sidebar-topic"><a href="/topics/performance">performance</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/postgres">postgres</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/processing">processing</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/rails">rails</a><span class="topic-count"> (<i>4</i>)</span></div><div class="sidebar-topic"><a href="/topics/react">react</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/ruby">ruby</a><span class="topic-count"> (<i>9</i>)</span></div><div class="sidebar-topic"><a href="/topics/seo">seo</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/slim">slim</a><span class="topic-count"> (<i>1</i>)</span></div><div class="sidebar-topic"><a href="/topics/social">social</a><span class="topic-count"> (<i>2</i>)</span></div><div class="sidebar-topic"><a href="/topics/testing">testing</a><span class="topic-count"> (<i>1</i>)</span></div></aside><div class="header"><a class="header__logo" href="http://www.icelab.com.au"></a><a href="/" class="header__til-text">Today Icelab Learnt</a><button class="header__view-topics open-sidebar" data-view-toggle-sidebar="">&lsaquo; <span>View</span> topics </button></div><div class="container"><div class="article"><h2 class="article__title"><a href="/hash-new-with-a-block-works-well-as-a-keyed-cache/">Hash.new with a block works well as a keyed&nbsp;cache</a></h2><div class="article__meta">Tim Riley, 23 May 2016</div><div class="article__content" data-view-highlight=""><p>We&rsquo;re all familiar with the <code>@foo ||= expensive_computation</code> technique to memoize (i.e. cache) the output of slow computations or to avoid unnecessary object creation.</p>

<p>If you want to do the same but with results that will vary by a single parameter, you can use Ruby&rsquo;s hash with its <a href="http://ruby-doc.org/core-2.3.1/Hash.html#method-c-new">block-based initializer</a> to handle the caching for you:</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">my_cache</span>
  <span class="vi">@my_cache</span> <span class="o">||=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="nb">hash</span><span class="p">,</span> <span class="n">key</span><span class="o">|</span>
    <span class="nb">hash</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">some_slow_computation</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Computed once</span>
<span class="n">my_cache</span><span class="p">[</span><span class="ss">:foo</span><span class="p">]</span>

<span class="c1"># Then cached</span>
<span class="n">my_cache</span><span class="p">[</span><span class="ss">:foo</span><span class="p">]</span>
</code></pre>

<p>You can see this work in practice <a href="https://github.com/dry-rb/dry-component/blob/0bebc656b625a18c25e3c8d9c4b71946fecac5e1/lib/dry/component/injector.rb#L56-L60">inside dry-component&rsquo;s Injector</a>, where it caches objects to allow arbitrarily long chaining of injector strategies without creating duplicate injector objects.</p>
</div><div class="article__tags"><a href="/topics/ruby" class="article__tag">ruby</a></div></div><div class="article"><h2 class="article__title"><a href="/selecting-colours-in-html/">Selecting colours in&nbsp;HTML</a></h2><div class="article__meta">Max Wheeler, 22 May 2016</div><div class="article__content" data-view-highlight=""><p>Somehow in the excitement around HTML5’s new input types I missed the addition of an input type specifically for selecting colours:</p>
<pre class="highlight html"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"color"</span><span class="nt">&gt;</span>
</code></pre>

<p>Include this and you’ll get a platform-native colour selector that takes and returns hex colour values, like my debugging colour of choice <code>#ff0099</code>:</p>

<p data-height="200" data-theme-id="0" data-slug-hash="vGogBW" data-default-tab="result" data-user="makenosound" data-embed-version="2" class="codepen">Selecting colours in HTML <a href="http://codepen.io/makenosound/pen/vGogBW/">vGogBW</a></p>

<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>Note that the value needs to a fully hex string, not a shortcut like <code>#f09</code>. And, alas, if you’re viewing this in Safari you’ll notice that it isn’t supported at all.</p>
</div><div class="article__tags"><a href="/topics/html" class="article__tag">html</a></div></div><div class="article"><h2 class="article__title"><a href="/creating-an-iam-user-for-s3-bucket/">Creating an IAM user for access to an S3&nbsp;bucket</a></h2><div class="article__meta">Tim Riley, 04 April 2016</div><div class="article__content" data-view-highlight=""><p>When you create an S3 bucket for a web app to use, you should create a specific IAM user to grant access to that bucket.</p>

<p>To do this, first create a user:</p>

<ol>
<li>Visit the <a href="https://console.aws.amazon.com/iam">IAM section of the AWS console</a></li>
<li>Go to the &ldquo;Users&rdquo; section and click the &ldquo;Create New Users&rdquo; button</li>
<li>Enter the user name(s) you want to create (e.g. <code>my-bucket-s3</code> for a bucket named <code>my-bucket</code>)</li>
<li>When you&rsquo;re shown the user credentials, save them somewhere safe, like our team 1Password vault</li>
<li>When you return to the IAM users list, go to the newly created user and click on their &ldquo;Permissions&rdquo; tab. Click on the &ldquo;Inline Policies&rdquo; section and create a new policy</li>
<li>Choose to create a &ldquo;Custom Policy&rdquo;</li>
<li><p>Name the policy &ldquo;my-bucket-s3-access&rdquo; (or something similarly descriptive) and paste the following into the &ldquo;Policy Document&rdquo; area (replacing <code>my-bucket</code> with your bucket&rsquo;s name):</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:ListAllMyBuckets"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::*"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:*"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::my-bucket"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::my-bucket/*"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></li>
<li><p>Click &ldquo;Apply Policy&rdquo;</p></li>
</ol>

<p>The access policy should now be active and your app should be able to access the bucket with the new IAM user&rsquo;s credentials.</p>
</div><div class="article__tags"><a href="/topics/aws" class="article__tag">aws</a></div></div><div class="article"><h2 class="article__title"><a href="/chrome-vox/">ChromeVox</a></h2><div class="article__meta">Andy McCray, 08 March 2016</div><div class="article__content" data-view-highlight=""><p><a href="http://www.chromevox.com/">ChromeVox</a> is a screen reader extension for Chrome.</p>

<p>I found it a helpful extension when addressing accessibility issues on a recent project. I was able to replicate the voice prompts noted in the accessibility audit. Thus, fixing them was much easier!</p>

<p>One thing to note is that you&rsquo;ll want to change the default voice. The default just seems to cackle at you. You can do this via <code>Settings &gt; Extensions &gt; ChromeVox &gt; Options</code>.</p>
</div><div class="article__tags"><a href="/topics/accessibility" class="article__tag">accessibility</a></div></div><div class="article"><h2 class="article__title"><a href="/cloudfront-origin-pull-with-gzip/">Using CloudFront as ‘origin pull’ (with bonus&nbsp;gzip)</a></h2><div class="article__meta">Max Wheeler, 16 February 2016</div><div class="article__content" data-view-highlight=""><p>CloudFront can act as a CDN that ‘pulls’ content from an origin server. It’s really easy to set up, you simply set the ‘Origin Domain Name’ to wherever you’re hosting your app: <code>foobar.herokuapp.com</code> for example and then &hellip; nothing. That’s all you need to do. Requests that come through CloudFront will pass through to your origin server and then be cached thereafter.</p>

<p>For bonus points it’ll also gzip your content for you without you having to do much work at all. Set ‘Compress Objects Automatically’ to ‘Yes’ and you’re done. If CloudFront can serve a gzipped version (and the client can receive one) it’ll serve up a compressed version of your file instead.</p>
</div><div class="article__tags"><a href="/topics/performance" class="article__tag">performance</a><a href="/topics/aws" class="article__tag">aws</a></div></div><div class="article"><h2 class="article__title"><a href="/async-set-state/">In React setState is not &quot;guaranteed&quot; to be&nbsp;synchronous.</a></h2><div class="article__meta">Narinda Reeders, 19 November 2015</div><div class="article__content" data-view-highlight=""><p>I discovered recently that if you do something link this in react:</p>
<pre class="highlight javascript"><code><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">reallyUseful</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>

<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">reallyUseful</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">doSomethingAmazing</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>&hellip; it&rsquo;s not very useful and more often than not nothing amazing happens, just confusion and sadness.</p>

<p>This is because <code>setState</code> it turns out, is asynchronous. Of course most of the time you are doing your amazing things in your render function so everything is sweet but on the odd occasion that you need to pass that value elsewhere, eg: publishing an event, beware!</p>

<p>From the docs:</p>

<blockquote>
<p>setState() does not immediately mutate this.state but creates a pending state transition. Accessing this.state after calling this method can potentially return the existing value.</p>

<p>There is no guarantee of synchronous operation of calls to setState and calls may be batched for performance gains.</p>
</blockquote>

<p>Read about <code>setState</code> <a href="https://facebook.github.io/react/docs/component-api.html">here</a>.</p>

<p><em>Editor’s note — <code>setState</code> will also take a callback as its second argument that’ll be executed after <code>this.state</code> has been updated:</em></p>
<pre class="highlight javascript"><code><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span>
  <span class="p">{</span> <span class="na">reallyUseful</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">reallyUseful</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">doSomethingAmazing</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">)</span>
</code></pre>
</div><div class="article__tags"><a href="/topics/react" class="article__tag">react</a><a href="/topics/javascript" class="article__tag">javascript</a></div></div><div class="article"><h2 class="article__title"><a href="/symbolize-keys/">Symbolize&nbsp;keys</a></h2><div class="article__meta">Jojo Hall, 19 November 2015</div><div class="article__content" data-view-highlight=""><p>If you&rsquo;re writing plain old Ruby you can symbolize the keys of a hash with the following:</p>
<pre class="highlight ruby"><code><span class="nb">hash</span><span class="p">.</span><span class="nf">inject</span><span class="p">({}){</span><span class="o">|</span><span class="n">memo</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">|</span> <span class="n">memo</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="nf">to_sym</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span> <span class="n">memo</span><span class="p">}</span>
</code></pre>

<p>This does the following:</p>
<pre class="highlight ruby"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"hello"</span> <span class="o">=&gt;</span> <span class="s2">"jojo"</span><span class="p">}</span>
<span class="nb">hash</span><span class="p">.</span><span class="nf">inject</span><span class="p">({}){</span><span class="o">|</span><span class="n">memo</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="o">|</span> <span class="n">memo</span><span class="p">[</span><span class="n">k</span><span class="p">.</span><span class="nf">to_sym</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span> <span class="n">memo</span><span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:hello</span><span class="o">=&gt;</span><span class="s2">"jojo"</span><span class="p">}</span>
</code></pre>

<p>However if you&rsquo;re doing this in a web application you may want to make a module to make hash and array data transformations easily available to you. In most of our apps we would use <a href="https://github.com/solnic/transproc">transproc</a> to help us with this — if you&rsquo;re working in one of Icelab&rsquo;s Rodakase apps this will be available to you.</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s2">"transproc/all"</span>

<span class="k">module</span> <span class="nn">Functions</span>
  <span class="kp">extend</span> <span class="no">Transproc</span><span class="o">::</span><span class="no">Registry</span>

  <span class="n">import</span> <span class="no">Transproc</span><span class="o">::</span><span class="no">HashTransformations</span>
  <span class="n">import</span> <span class="no">Transproc</span><span class="o">::</span><span class="no">ArrayTransformations</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">t</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">[</span><span class="o">*</span><span class="n">args</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Functions</span><span class="p">.</span><span class="nf">t</span><span class="p">(</span><span class="ss">:symbolize_keys</span><span class="p">)[{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="s2">"bar"</span><span class="p">}]</span>
<span class="c1"># =&gt; {foo: "bar"}</span>
</code></pre>

<p>If you are using Rails then you can use the method <code>hash.symbolize_keys</code> or the destructive version <code>hash.symbolize_keys!</code><br>
(both made available via ActiveSupport).</p>
</div><div class="article__tags"><a href="/topics/ruby" class="article__tag">ruby</a></div></div><div class="article"><h2 class="article__title"><a href="/pry-is-amazing/">Pry is&nbsp;amazing</a></h2><div class="article__meta">Tim Riley, 11 November 2015</div><div class="article__content" data-view-highlight=""><p><a href="https://github.com/pry/pry">Pry</a> is amazing! It has a whole bunch of helpful shortcuts you can use while working in a session.</p>

<p>I found the <a href="https://github.com/pry/pry/wiki/Exceptions">exception handling shortcuts</a> particularly helpful. <code>_ex_</code> will give you the last raised exception, and <code>wtf?</code> will show you a stacktrace from that exception (which is helpful, since stacktraces aren&rsquo;t normally shown in interactive terminal sessions like this). Hilariously, you can add more question marks or exclamation marks on the end to see more detail.</p>

<p>If you work with Ruby app consoles regularly, you&rsquo;d do yourself a favour to give the <a href="https://github.com/pry/pry/wiki">Pry Wiki</a> a good read!</p>
</div><div class="article__tags"><a href="/topics/ruby" class="article__tag">ruby</a><a href="/topics/debugging" class="article__tag">debugging</a></div></div><div class="article"><h2 class="article__title"><a href="/aws-elasticsearch-authentication/">Authenticating with AWS&nbsp;Elasticsearch</a></h2><div class="article__meta">Andrew Croome, 21 October 2015</div><div class="article__content" data-view-highlight=""><p>The AWS Elasticseach service offers authentication via an IAM user, or by whitelisting IPs.</p>

<p>Here&rsquo;s how to use IAM credentials to sign requests to the service when using Faraday and how to hook that into the Ruby elasticsearch gem.</p>

<p>To sign requests using Faraday, you can use a gem called <a href="https://github.com/winebarrel/faraday_middleware-aws-signers-v4">faraday_middleware-aws-signers-v4</a>, which provides a middleware that will sign your requests.</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'faraday_middleware'</span>
<span class="nb">require</span> <span class="s1">'faraday_middleware/aws_signers_v4'</span>

<span class="n">conn</span> <span class="o">=</span> <span class="no">Faraday</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">url: </span><span class="s1">'address-of-your-AWS-es-service'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">faraday</span><span class="o">|</span>
  <span class="n">faraday</span><span class="p">.</span><span class="nf">request</span> <span class="ss">:aws_signers_v4</span><span class="p">,</span> <span class="p">{</span>
    <span class="ss">credentials: </span><span class="no">Aws</span><span class="o">::</span><span class="no">Credentials</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'AWS_ACCESS_KEY_ID'</span><span class="p">],</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'AWS_SECRET_ACCESS_KEY'</span><span class="p">]),</span>
    <span class="ss">service_name: </span><span class="s1">'es'</span><span class="p">,</span>
    <span class="ss">region: </span><span class="s1">'ap-southeast-2'</span>
  <span class="p">}</span>

  <span class="n">faraday</span><span class="p">.</span><span class="nf">adapter</span> <span class="ss">:typhoeus</span>
<span class="k">end</span>
</code></pre>

<p>To get the client provided by the elasticsearch gem to use your Faraday configuation, you can pass that configuration to it like so:</p>
<pre class="highlight ruby"><code><span class="n">faraday_config</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">faraday</span><span class="o">|</span>
  <span class="n">faraday</span><span class="p">.</span><span class="nf">request</span> <span class="ss">:aws_signers_v4</span><span class="p">,</span> <span class="p">{</span>
    <span class="ss">credentials: </span><span class="no">Aws</span><span class="o">::</span><span class="no">Credentials</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="no">ENV</span><span class="p">[</span><span class="s2">"ELASTICSEARCH_AWS_ACCESS_KEY_ID"</span><span class="p">],</span>
      <span class="no">ENV</span><span class="p">[</span><span class="s2">"ELASTICSEARCH_AWS_SECRET_ACCESS_KEY"</span><span class="p">]</span>
      <span class="p">),</span>
      <span class="ss">service_name: </span><span class="s2">"es"</span><span class="p">,</span>
      <span class="ss">region: </span><span class="no">ENV</span><span class="p">[</span><span class="s2">"ELASTICSEARCH_AWS_REGION"</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="n">faraday</span><span class="p">.</span><span class="nf">adapter</span> <span class="ss">:typhoeus</span>
  <span class="k">end</span>

<span class="n">elasticsearch_host_config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">host:   </span><span class="no">ENV</span><span class="p">[</span><span class="s2">"ELASTICSEARCH_HOST"</span><span class="p">],</span>
  <span class="ss">port:   </span><span class="no">ENV</span><span class="p">[</span><span class="s2">"ELASTICSEARCH_PORT"</span><span class="p">],</span>
  <span class="ss">scheme: </span><span class="no">ENV</span><span class="p">[</span><span class="s2">"ELASTICSEARCH_SCHEME"</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">transport</span> <span class="o">=</span> <span class="no">Elasticsearch</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">Transport</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Faraday</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">hosts: </span><span class="p">[</span><span class="n">elasticsearch_host_config</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">faraday_config</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="no">Elasticsearch</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">transport: </span><span class="n">transport</span><span class="p">)</span>
</code></pre>

<p>You can then use the client object as usual, and you&rsquo;ll get automatically signed requests.</p>
</div><div class="article__tags"><a href="/topics/ruby" class="article__tag">ruby</a><a href="/topics/aws" class="article__tag">aws</a></div></div><div class="article"><h2 class="article__title"><a href="/using-arel-to-compare-attributes-of-a-record/">Using Arel to compare attributes of a&nbsp;record</a></h2><div class="article__meta">Daniel Nitsikopoulos, 24 September 2015</div><div class="article__content" data-view-highlight=""><p>I was just trying to find a way to run a query and compare the <code>updated_at</code> and <code>created_at</code> attributes of a record and came across this technique:</p>
<pre class="highlight ruby"><code><span class="n">users</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">arel_table</span>
<span class="no">User</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="ss">:created_at</span><span class="p">].</span><span class="nf">eq</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="ss">:updated_at</span><span class="p">]))</span>
</code></pre>

<p>It seems like <code>.gt</code> and <code>.lt</code> also work. While <code>User.where(&quot;created_at = updated_at&quot;)</code> would also work in SQL, we can use Arel to be database agnostic.</p>

<p><em><a href="https://github.com/rails/arel">Arel docs</a></em></p>
</div><div class="article__tags"><a href="/topics/rails" class="article__tag">rails</a></div></div><div class="pagination"><a href="/page/2/" class="pagination__older">Older &rsaquo;</a></div></div><div class="footer">A knowledge base of little learnings from the team at Icelab. <a href="https://github.com/icelab/til/">Source on GitHub</a>.</div><script>!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(9)},,,,,,function(t,e){!function(){function e(t,e){r?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function n(t){document.body?t():r?document.addEventListener("DOMContentLoaded",t):document.attachEvent("onreadystatechange",function(){"interactive"!=document.readyState&&"complete"!=document.readyState||t()})}function i(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function o(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+e+";"}function a(t){var e=t.a.offsetWidth,n=e+100;return t.f.style.width=n+"px",t.c.scrollLeft=n,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e?(t.g=e,!0):!1}function l(t,n){function i(){var t=o;a(t)&&null!==t.a.parentNode&&n(t.g)}var o=t;e(t.b,i),e(t.c,i),a(t)}function s(t,e){var n=e||{};this.family=t,this.style=n.style||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"normal"}function c(){if(null===f){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(e){}f=""!==t.style.font}return f}function d(t,e){return[t.style,t.weight,c()?t.stretch:"","100px",e].join(" ")}var r=!!document.addEventListener,h=null,f=null,m=!!window.FontFace;s.prototype.load=function(t,e){var a=this,s=t||"BESbswy",c=e||3e3,r=(new Date).getTime();return new Promise(function(t,e){if(m){var f=new Promise(function(t,e){function n(){(new Date).getTime()-r>=c?e():document.fonts.load(d(a,a.family),s).then(function(e){1<=e.length?t():setTimeout(n,25)},function(){e()})}n()}),u=new Promise(function(t,e){setTimeout(e,c)});Promise.race([u,f]).then(function(){t(a)},function(){e(a)})}else n(function(){function n(){var e;(e=-1!=w&&-1!=y||-1!=w&&-1!=v||-1!=y&&-1!=v)&&((e=w!=y&&w!=v&&y!=v)||(null===h&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),h=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=h&&(w==g&&y==g&&v==g||w==x&&y==x&&v==x||w==b&&y==b&&v==b)),e=!e),e&&(null!==T.parentNode&&T.parentNode.removeChild(T),clearTimeout(E),t(a))}function f(){if((new Date).getTime()-r>=c)null!==T.parentNode&&T.parentNode.removeChild(T),e(a);else{var t=document.hidden;!0!==t&&void 0!==t||(w=m.a.offsetWidth,y=u.a.offsetWidth,v=p.a.offsetWidth,n()),E=setTimeout(f,50)}}var m=new i(s),u=new i(s),p=new i(s),w=-1,y=-1,v=-1,g=-1,x=-1,b=-1,T=document.createElement("div"),E=0;T.dir="ltr",o(m,d(a,"sans-serif")),o(u,d(a,"serif")),o(p,d(a,"monospace")),T.appendChild(m.a),T.appendChild(u.a),T.appendChild(p.a),document.body.appendChild(T),g=m.a.offsetWidth,x=u.a.offsetWidth,b=p.a.offsetWidth,f(),l(m,function(t){w=t,n()}),o(m,d(a,'"'+a.family+'",sans-serif')),l(u,function(t){y=t,n()}),o(u,d(a,'"'+a.family+'",serif')),l(p,function(t){v=t,n()}),o(p,d(a,'"'+a.family+'",monospace'))})})},window.FontFaceObserver=s,window.FontFaceObserver.prototype.check=window.FontFaceObserver.prototype.load=s.prototype.load,"undefined"!=typeof t&&(t.exports=window.FontFaceObserver)}()},,function(t,e,n){function i(t){var e=window.localStorage.getItem("fontsLoaded");if(!e){var n=[];t.forEach(function(t){var e=new window.FontFaceObserver(t.family,{weight:t.weight,style:t.style});n.push(e.check())}),Promise.all(n).then(function(){window.document.documentElement.className+=" fonts-loaded",window.localStorage.setItem("fontsLoaded",!0)})}}n(6);var o=[{family:"National",style:"normal",weight:"normal"},{family:"National",style:"italic",weight:"normal"},{family:"National",style:"italic",weight:"bold"},{family:"National",style:"italic",weight:"bold"},{family:"TiemposText",style:"normal",weight:"normal"},{family:"TiemposText",style:"italic",weight:"normal"},{family:"TiemposText",style:"italic",weight:"bold"},{family:"TiemposText",style:"italic",weight:"bold"},{family:"Inconsolata",style:"normal",weight:"400"},{family:"Inconsolata",style:"italic",weight:"400"}];i(o)},function(t,e,n){n.p="/assets/",n(8)}]);</script></body></html>